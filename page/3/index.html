<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
	<meta name="generator" content="Hugo 0.110.0">
    
      <meta name="theme" content='FixIt v0.2.17'>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢</title><meta name="author" content="">
<meta name="author-link" content="">
<meta name="description" content="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢" /><meta name="keywords" content='J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ, è¿™é‡Œæ˜¯ J5land çš„åšå®¢' /><meta itemprop="name" content="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢">
<meta itemprop="description" content="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢"><meta property="og:title" content="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢" />
<meta property="og:description" content="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://example.org/" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢"/>
<meta name="twitter:description" content="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢"/>
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="http://example.org/" /><link rel="alternate" href="/index.xml" type="application/rss+xml" title="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebSite",
    "url": "http:\/\/example.org\/","inLanguage": "zh-CN","description": "J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢","name": "J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢"
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢"><img
    class="lazyload logo"
    src="/svg/loading.min.svg"
    data-src="/assets/logo.png"
    data-srcset="/assets/logo.png, /assets/logo.png 1.5x, /assets/logo.png 2x"
    data-sizes="auto"
    alt="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢"
    title="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢"/><span class="header-title-text"></span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> æ–‡ç« </a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> åˆ†ç±»</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> æ ‡ç­¾</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹ ..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li>
      </ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="J5land, ç¨‹åºå‘˜, å¹¿å‘Šè¡Œä¸š, äº‘åŸç”Ÿ | è¿™é‡Œæ˜¯ J5land çš„åšå®¢"><img
    class="lazyload logo"
    src="/svg/loading.min.svg"
    data-src="/assets/logo.png"
    data-srcset="/assets/logo.png, /assets/logo.png 1.5x, /assets/logo.png 2x"
    data-sizes="auto"
    alt="/assets/logo.png"
    title="/assets/logo.png"/><span class="header-title-text"></span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹ ..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              å–æ¶ˆ
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> æ–‡ç« </a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> åˆ†ç±»</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> æ ‡ç­¾</a></li><li class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container" data-page-style="normal"><div class="page home posts"><div class="home-profile"><div class="home-avatar"><a href="/posts/" title="æ–‡ç« "><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="/assets/avatar.png?s=240&amp;d=mp"
    data-srcset="/assets/avatar.png?s=240&amp;d=mp, /assets/avatar.png?s=240&amp;d=mp 1.5x, /assets/avatar.png?s=240&amp;d=mp 2x"
    data-sizes="auto"
    alt="/assets/avatar.png?s=240&amp;d=mp"
    title="/assets/avatar.png?s=240&amp;d=mp"/></a></div><h1 class="home-title">Hi ğŸ‘‹, I'm j5land</h1><h2 class="home-subtitle"><span class="d-none">ä¸“æ³¨å¹¿å‘ŠæŠ€æœ¯ï¼Œå–œæ¬¢é«˜å¹¶å‘æŠ€æœ¯ï¼Œå­¦ä¹ K8s/å®¹å™¨æŠ€æœ¯ï¼ŒæœŸå¾…ä¸å¤§å®¶åˆ†äº«ç»éªŒï¼Œå…±åŒå­¦ä¹ ã€‚</span>
        <span id="typeit-profile-subtitle" class="typeit"></span></h2><div class="links"><a href="https://github.com/j5land" title="GitHub"target="_blank" rel="external nofollow noopener noreferrer me"><i class="fa-brands fa-github-alt fa-fw" aria-hidden="true"></i>
    </a><a href="https://wpa.qq.com/msgrd?v=3&amp;uin=12507149&amp;site=qq&amp;menu=yes" title="QQ"target="_blank" rel="external nofollow noopener noreferrer me"><i data-svg-src="/lib/simple-icons/icons/tencentqq.min.svg" aria-hidden="true"></i>
    </a><a href="mailto:jianghr1@126.com" title="Email" rel=" me"><i class="fa-regular fa-envelope fa-fw" aria-hidden="true"></i>
    </a><a href="/index.xml" title="RSS"target="_blank" rel="external nofollow noopener noreferrer me"><i class="fa-solid fa-rss fa-fw" aria-hidden="true"></i>
    </a></div></div>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
      <a href="/posts/%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3hbase%E7%9A%84%E5%AD%98%E5%82%A8%E8%AE%BE%E8%AE%A1%E5%8F%8A%E4%BC%B8%E7%BC%A9%E6%80%A7%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8/" aria-label="æ·±å…¥äº†è§£HBaseçš„å­˜å‚¨è®¾è®¡åŠä¼¸ç¼©æ€§ä¸é«˜å¯ç”¨"><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="/posts/images/hbase2-1.png"
    data-srcset="/posts/images/hbase2-1.png, /posts/images/hbase2-1.png 1.5x, /posts/images/hbase2-1.png 2x"
    data-sizes="auto"
    alt="/posts/images/hbase2-1.png"
    title="/posts/images/hbase2-1.png"/></a>
    </div><h1 class="single-title" itemprop="name headline">
    <span title="è½¬è½½" class="icon-repost"><i class="fa-solid fa-share fa-fw" aria-hidden="true"></i></span><a href="/posts/%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3hbase%E7%9A%84%E5%AD%98%E5%82%A8%E8%AE%BE%E8%AE%A1%E5%8F%8A%E4%BC%B8%E7%BC%A9%E6%80%A7%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8/">æ·±å…¥äº†è§£HBaseçš„å­˜å‚¨è®¾è®¡åŠä¼¸ç¼©æ€§ä¸é«˜å¯ç”¨</a>
  </h1><div class="post-meta"><span class="post-author"><span class="author"><img
    class="lazyload avatar"
    src="/svg/loading.min.svg"
    data-src="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c,%20string=%29"
    data-srcset="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 1.5x, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 2x"
    data-sizes="auto"
    alt="j5land"
    title="j5land"/>&nbsp;j5land</span></span>&nbsp;<span class="post-publish" title='2023-03-01 16:00:18'>å‘å¸ƒäº <time datetime="2023-03-01">2023-03-01</time></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/hbase/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> HBase</a></span></div><div class="content">ä¸»è¦å†…å®¹ HBaseå­˜å‚¨è®¾è®¡ HBaseè¯»å†™æµç¨‹ HBase Campactionï¼ˆä¼¸ç¼©æ€§ï¼‰ HBaseé«˜å¯ç”¨ï¼ˆç¾å¤‡ï¼‰ HBaseå­˜å‚¨è®¾è®¡ åº•å±‚å­˜å‚¨ HBaseçš„åº•</div><div class="post-footer">
    <a href="/posts/%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3hbase%E7%9A%84%E5%AD%98%E5%82%A8%E8%AE%BE%E8%AE%A1%E5%8F%8A%E4%BC%B8%E7%BC%A9%E6%80%A7%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8/">é˜…è¯»å…¨æ–‡</a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/hbase/' class="post-tag">HBase</a><a href='/tags/nosql/' class="post-tag">NoSQL</a><a href='/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/' class="post-tag">æ¶æ„è®¾è®¡</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
      <a href="/posts/%E5%8D%81%E5%88%86%E9%92%9F%E4%BA%86%E8%A7%A3hbase%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E5%92%8C%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84/" aria-label="ååˆ†é’Ÿäº†è§£HbaseåŸºç¡€æ¦‚å¿µå’Œå­˜å‚¨æ¶æ„"><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="/posts/images/hbase-2.png"
    data-srcset="/posts/images/hbase-2.png, /posts/images/hbase-2.png 1.5x, /posts/images/hbase-2.png 2x"
    data-sizes="auto"
    alt="/posts/images/hbase-2.png"
    title="/posts/images/hbase-2.png"/></a>
    </div><h1 class="single-title" itemprop="name headline">
    <span title="è½¬è½½" class="icon-repost"><i class="fa-solid fa-share fa-fw" aria-hidden="true"></i></span><a href="/posts/%E5%8D%81%E5%88%86%E9%92%9F%E4%BA%86%E8%A7%A3hbase%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E5%92%8C%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84/">ååˆ†é’Ÿäº†è§£HbaseåŸºç¡€æ¦‚å¿µå’Œå­˜å‚¨æ¶æ„</a>
  </h1><div class="post-meta"><span class="post-author"><span class="author"><img
    class="lazyload avatar"
    src="/svg/loading.min.svg"
    data-src="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c,%20string=%29"
    data-srcset="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 1.5x, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 2x"
    data-sizes="auto"
    alt="j5land"
    title="j5land"/>&nbsp;j5land</span></span>&nbsp;<span class="post-publish" title='2023-02-15 16:05:44'>å‘å¸ƒäº <time datetime="2023-02-15">2023-02-15</time></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/hbase/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> HBase</a></span></div><div class="content">HBase åŸºç¡€æ¦‚å¿µå’Œæ¶æ„ HBase ä»‹ç» HBase æ˜¯ BigTable çš„å¼€æº Java ç‰ˆæœ¬ã€‚æ˜¯å»ºç«‹åœ¨ HDFS ä¹‹ä¸Šï¼Œæä¾›é«˜å¯é æ€§ã€é«˜æ€§èƒ½ã€åˆ—å­˜å‚¨ã€å¯ä¼¸ç¼©ã€å®æ—¶è¯»å†™ NoSql çš„æ•°æ®åº“ç³»ç»Ÿã€‚ å®ƒä»‹äº NoSql å’Œ RDBMS ä¹‹é—´ï¼Œä»…</div><div class="post-footer">
    <a href="/posts/%E5%8D%81%E5%88%86%E9%92%9F%E4%BA%86%E8%A7%A3hbase%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E5%92%8C%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84/">é˜…è¯»å…¨æ–‡</a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/hbase/' class="post-tag">HBase</a><a href='/tags/nosql/' class="post-tag">NoSQL</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
      <a href="/posts/%E6%8F%AD%E7%A7%98%E5%B9%BF%E5%91%8A%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" aria-label="æ­ç§˜å¹¿å‘Šæ¶æ„ä¸ç³»ç»Ÿè®¾è®¡"><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="/posts/images/%e5%b9%bf%e5%91%8a%e6%b5%81%e7%a8%8b%e5%9b%be.jpg"
    data-srcset="/posts/images/%e5%b9%bf%e5%91%8a%e6%b5%81%e7%a8%8b%e5%9b%be.jpg, /posts/images/%e5%b9%bf%e5%91%8a%e6%b5%81%e7%a8%8b%e5%9b%be.jpg 1.5x, /posts/images/%e5%b9%bf%e5%91%8a%e6%b5%81%e7%a8%8b%e5%9b%be.jpg 2x"
    data-sizes="auto"
    alt="/posts/images/å¹¿å‘Šæµç¨‹å›¾.jpg"
    title="/posts/images/å¹¿å‘Šæµç¨‹å›¾.jpg"/></a>
    </div><h1 class="single-title" itemprop="name headline">
    <span title="è½¬è½½" class="icon-repost"><i class="fa-solid fa-share fa-fw" aria-hidden="true"></i></span><a href="/posts/%E6%8F%AD%E7%A7%98%E5%B9%BF%E5%91%8A%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">æ­ç§˜å¹¿å‘Šæ¶æ„ä¸ç³»ç»Ÿè®¾è®¡</a>
  </h1><div class="post-meta"><span class="post-author"><span class="author"><img
    class="lazyload avatar"
    src="/svg/loading.min.svg"
    data-src="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c,%20string=%29"
    data-srcset="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 1.5x, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 2x"
    data-sizes="auto"
    alt="j5land"
    title="j5land"/>&nbsp;j5land</span></span>&nbsp;<span class="post-publish" title='2023-02-01 14:28:22'>å‘å¸ƒäº <time datetime="2023-02-01">2023-02-01</time></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> æ¶æ„è®¾è®¡</a></span></div><div class="content">å¹¿å‘Šä¸šåŠ¡ å¹¿å‘Šã€æ¸¸æˆã€ç”µå•†ï¼Œæ˜¯äº’è”ç½‘ä¼ä¸šæœ€ä¸»è¦çš„ç›ˆåˆ©ä¸šåŠ¡æ¨¡å¼ã€‚å¹¿å‘Šå å¸‚åœºæ”¶å…¥ä»½é¢å¾ˆå¤§ï¼Œä¸šåŠ¡é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚ æˆ‘ä»¬å¤§è‡´ä»æŠ€æœ¯è§’åº¦æ¥çœ‹å¹¿å‘Šä¸šåŠ¡ï¼Œå¹¿å‘Š</div><div class="post-footer">
    <a href="/posts/%E6%8F%AD%E7%A7%98%E5%B9%BF%E5%91%8A%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">é˜…è¯»å…¨æ–‡</a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/%E5%B9%BF%E5%91%8A%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/' class="post-tag">å¹¿å‘Šç³»ç»Ÿè®¾è®¡</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
      <a href="/posts/lucene%E6%9F%A5%E8%AF%A2%E5%8E%9F%E7%90%86%E5%8F%8A%E8%A7%A3%E6%9E%90/" aria-label="LuceneæŸ¥è¯¢åŸç†åŠè§£æ"><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="/posts/images/Lucene.jpeg"
    data-srcset="/posts/images/Lucene.jpeg, /posts/images/Lucene.jpeg 1.5x, /posts/images/Lucene.jpeg 2x"
    data-sizes="auto"
    alt="/posts/images/Lucene.jpeg"
    title="/posts/images/Lucene.jpeg"/></a>
    </div><h1 class="single-title" itemprop="name headline">
    <span title="è½¬è½½" class="icon-repost"><i class="fa-solid fa-share fa-fw" aria-hidden="true"></i></span><a href="/posts/lucene%E6%9F%A5%E8%AF%A2%E5%8E%9F%E7%90%86%E5%8F%8A%E8%A7%A3%E6%9E%90/">LuceneæŸ¥è¯¢åŸç†åŠè§£æ</a>
  </h1><div class="post-meta"><span class="post-author"><span class="author"><img
    class="lazyload avatar"
    src="/svg/loading.min.svg"
    data-src="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c,%20string=%29"
    data-srcset="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 1.5x, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 2x"
    data-sizes="auto"
    alt="j5land"
    title="j5land"/>&nbsp;j5land</span></span>&nbsp;<span class="post-publish" title='2023-01-20 14:20:05'>å‘å¸ƒäº <time datetime="2023-01-20">2023-01-20</time></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/java/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Java</a></span></div><div class="content">å‰è¨€ Lucene æ˜¯ä¸€ä¸ªåŸºäºJavaçš„å…¨æ–‡ä¿¡æ¯æ£€ç´¢å·¥å…·åŒ…ï¼Œç›®å‰ä¸»æµçš„æœç´¢ç³»ç»ŸElasticsearchå’Œsolréƒ½æ˜¯åŸºäºLuceneçš„ç´¢å¼•å’Œæœç´¢èƒ½åŠ›è¿›è¡Œ</div><div class="post-footer">
    <a href="/posts/lucene%E6%9F%A5%E8%AF%A2%E5%8E%9F%E7%90%86%E5%8F%8A%E8%A7%A3%E6%9E%90/">é˜…è¯»å…¨æ–‡</a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/lucene/' class="post-tag">Lucene</a><a href='/tags/%E6%A3%80%E7%B4%A2%E5%BC%95%E6%93%8E/' class="post-tag">æ£€ç´¢å¼•æ“</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
      <a href="/posts/webclient%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B8%8E%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%95/" aria-label="WebClientæ€§èƒ½åˆ†æä¸å¯¹æ¯”æµ‹è¯•"><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="/posts/images/spring_webflux_preview.png"
    data-srcset="/posts/images/spring_webflux_preview.png, /posts/images/spring_webflux_preview.png 1.5x, /posts/images/spring_webflux_preview.png 2x"
    data-sizes="auto"
    alt="/posts/images/spring_webflux_preview.png"
    title="/posts/images/spring_webflux_preview.png"/></a>
    </div><h1 class="single-title" itemprop="name headline">
    <span title="è½¬è½½" class="icon-repost"><i class="fa-solid fa-share fa-fw" aria-hidden="true"></i></span><a href="/posts/webclient%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B8%8E%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%95/">WebClientæ€§èƒ½åˆ†æä¸å¯¹æ¯”æµ‹è¯•</a>
  </h1><div class="post-meta"><span class="post-author"><span class="author"><img
    class="lazyload avatar"
    src="/svg/loading.min.svg"
    data-src="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c,%20string=%29"
    data-srcset="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 1.5x, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 2x"
    data-sizes="auto"
    alt="j5land"
    title="j5land"/>&nbsp;j5land</span></span>&nbsp;<span class="post-publish" title='2023-01-16 11:51:21'>å‘å¸ƒäº <time datetime="2023-01-16">2023-01-16</time></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/java/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Java</a></span></div><div class="content"><h1 id="èƒŒæ™¯">èƒŒæ™¯</h1>
<p>åœ¨Spring 5ä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è°ƒç”¨å…¶ä»–ç³»ç»Ÿæä¾›çš„HTTPæœåŠ¡ï¼Œæˆ‘ä»¬é€šå¸¸å¯ä»¥ä½¿ç”¨Springæä¾›çš„RestTemplateæ¥è®¿é—®ã€‚RestTemplateç”¨æ³•å¾ˆç®€å•ï¼Œä½†å®ƒçš„ä¸è¶³ä¹‹å¤„åœ¨äºå®ƒçš„è¯·æ±‚æ˜¯åŒæ­¥é˜»å¡æ¨¡å¼ï¼Œå› æ­¤å­˜åœ¨ä¸€å®šæ€§èƒ½ç“¶é¢ˆï¼Œå½“ç„¶å¦‚æœæƒ³è¦ä½¿ç”¨å¼‚æ­¥æ–¹å¼è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨AsyncRestTemplateã€‚</p>
<p>ä»Spring 5å¼€å§‹ï¼ŒSpringä¸­å…¨é¢å¼•å…¥äº†Reactiveå“åº”å¼ç¼–ç¨‹ï¼ŒWebClientå°±å±äºSpring WebFlux çš„ä¸€éƒ¨åˆ†ã€‚WebClientçš„è¯·æ±‚æ¨¡å¼å±äºå¼‚æ­¥éé˜»å¡ã€ååº”å¼çš„ï¼Œèƒ½å¤Ÿä»¥å°‘é‡å›ºå®šçš„çº¿ç¨‹å¤„ç†é«˜å¹¶å‘çš„HTTP è¯·æ±‚ã€‚</p>
<p>å› æ­¤ï¼Œä»Spring 5 å¼€å§‹ï¼ŒHTTPæœåŠ¡ä¹‹é—´çš„é€šä¿¡æ–¹å¼æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨WebCLientæ¥å–ä»£ä¹‹å‰çš„RestTemplateã€‚</p>
<h1 id="webclient-è¯¦è§£">WebClient è¯¦è§£</h1>
<h2 id="webclientç‰¹ç‚¹">WebClientç‰¹ç‚¹</h2>
<p>webClientæ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„HTTPè¯·æ±‚å®¢æˆ·ç«¯ï¼Œæ”¯æŒä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>éé˜»å¡I/O</li>
<li>ååº”æµå›å‹ï¼ˆå³æ¶ˆè´¹è€…è´Ÿè½½è¿‡é«˜æ—¶ï¼Œä¸»åŠ¨åé¦ˆç”Ÿäº§è€…æ”¾æ…¢é€Ÿåº¦çš„æœºåˆ¶ï¼‰</li>
<li>å…·æœ‰é«˜å¹¶å‘æ€§ï¼Œç¡¬ä»¶èµ„æºæ¶ˆè€—æ›´å°‘</li>
<li>æµç¨‹çš„APIè®¾è®¡</li>
<li>åŒæ­¥ä¸å¼‚æ­¥äº¤äº’</li>
<li>æµå¼ä¼ è¾“æ”¯æŒ</li>
</ul>
<h1 id="webclient-å¼€å‘é…ç½®">WebClient å¼€å‘é…ç½®</h1>
<h2 id="1-æ·»åŠ ä¾èµ–">1 æ·»åŠ ä¾èµ–</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-webflux<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h2 id="2-åŸºç¡€é…ç½®">2 åŸºç¡€é…ç½®</h2>
<p>WebClient å®ä¾‹æ„é€ å™¨å¯ä»¥è®¾ç½®ä¸€äº›åŸºç¡€çš„å…¨å±€webè¯·æ±‚é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚é»˜è®¤çš„cookieã€headerã€baseUrlç­‰ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">WebClient</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">defaultCookie</span><span class="o">(</span><span class="s">&#34;kl&#34;</span><span class="o">,</span><span class="s">&#34;kl&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">defaultUriVariables</span><span class="o">(</span><span class="n">ImmutableMap</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span><span class="s">&#34;kl&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">defaultHeader</span><span class="o">(</span><span class="s">&#34;header&#34;</span><span class="o">,</span><span class="s">&#34;kl&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">defaultHeaders</span><span class="o">(</span><span class="n">httpHeaders</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">httpHeaders</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;header1&#34;</span><span class="o">,</span><span class="s">&#34;kl&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">httpHeaders</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;header2&#34;</span><span class="o">,</span><span class="s">&#34;kl&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">})</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">defaultCookies</span><span class="o">(</span><span class="n">cookie</span> <span class="o">-&gt;{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">cookie</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;cookie1&#34;</span><span class="o">,</span><span class="s">&#34;kl&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">cookie</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;cookie2&#34;</span><span class="o">,</span><span class="s">&#34;kl&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">})</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">baseUrl</span><span class="o">(</span><span class="s">&#34;http://www.compay.com&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><h2 id="3-åº•å±‚ä¾èµ–nettyåº“é…ç½®">3 åº•å±‚ä¾èµ–Nettyåº“é…ç½®</h2>
<p>é€šè¿‡é…ç½®Nettyåº•å±‚åº“ï¼Œå¯ä»¥é…ç½®SSLå®‰å…¨é“¾æ¥ã€è¯·æ±‚è¶…æ—¶ã€è¯»å†™è¶…æ—¶ç­‰ã€‚</p>
<p>å¯ä»¥é€šè¿‡é…ç½®åŠ¨æ€è¿æ¥æ± ï¼Œè‡ªå®šä¹‰çªç ´è¿™äº›é»˜è®¤é…ç½®ã€‚åŒ…æ‹¬Nettyçš„selectçº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹ä¹Ÿå¯ä»¥è‡ªå·±è®¾ç½®ã€‚</p>
<ul>
<li>æœ€å¤§è¿æ¥æ•°ï¼ˆmaxConnectionsï¼‰ï¼šConnectionProviderè¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°é€‰é¡¹ï¼Œé»˜è®¤ä¸º<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/resources/ConnectionProvider.html#DEFAULT_POOL_MAX_CONNECTIONS"target="_blank" rel="external nofollow noopener noreferrer"><code>ConnectionProvider.DEFAULT_POOL_MAX_CONNECTIONS</code></a>ï¼Œå³ï¼š2 * å¯ç”¨å¤„ç†å™¨æ•°ï¼ˆä½†æœ€å°å€¼ä¸º 16ï¼‰ï¼Œ<a href="https://github.com/reactor/reactor-netty/issues/2052"target="_blank" rel="external nofollow noopener noreferrer">#2052</a>
<ul>
<li>Reactor Netty æä¾›äº†ä¸¤ç§åˆ›å»ºå®¢æˆ·ç«¯çš„æ–¹å¼
<ul>
<li><code>HttpClient.create()</code>- è¿™ä½¿ç”¨<strong>é¢„å®šä¹‰</strong> <code>ConnectionProvider</code>çš„ï¼Œå®ƒæ˜¯è¿™æ ·åˆ›å»ºçš„<code>ConnectionProvider.create(name, 500)</code>ã€‚è¿™æ„å‘³ç€<code>500</code> <code>maxConnections</code>ï¼ˆè¿™æ˜¯åœ¨æ„å»ºå™¨ä¸­æ˜ç¡®æŒ‡å®šçš„<code>ConnectionProvider</code>ï¼‰å’Œ<code>1000</code> <code>pendingAcquireMaxCount</code>ï¼ˆè¿™æ˜¯<code>ConnectionProvider</code>æ„å»ºå™¨æä¾›çš„é»˜è®¤å€¼ï¼‰</li>
<li><code>HttpClient.create(ConnectionProvider)</code>- ç”¨æˆ·æä¾›è‡ªå®šä¹‰<code>ConnectionProvider</code></li>
<li>JavaDocï¼šhttps://projectreactor.io/docs/netty/release/api/reactor/netty/resources/ConnectionProvider.ConnectionPoolSpec.html#maxConnections-int-</li>
</ul>
</li>
</ul>
</li>
<li>æœ€å¤§ç©ºé—²æ—¶é—´ï¼ˆmaxIdleTimeï¼‰ï¼šé»˜è®¤<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/resources/ConnectionProvider.html#DEFAULT_POOL_MAX_IDLE_TIME"target="_blank" rel="external nofollow noopener noreferrer"><code>ConnectionProvider.DEFAULT_POOL_MAX_IDLE_TIME</code></a>ï¼Œé»˜è®¤æ— ç©ºé—²æ—¶é—´</li>
<li>æœ€å¤§å­˜æ´»æ—¶é—´ï¼ˆmaxLifeTimeï¼‰ï¼šé»˜è®¤<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/resources/ConnectionProvider.html#DEFAULT_POOL_MAX_LIFE_TIME"target="_blank" rel="external nofollow noopener noreferrer"><code>ConnectionProvider.DEFAULT_POOL_MAX_LIFE_TIME</code></a></li>
<li>ç­‰å¾…è·å–æ—¶é—´ï¼ˆpendingAcquireTimeoutï¼‰ï¼šè·å–è¿æ¥è¶…æ—¶é»˜è®¤45000msï¼Œå³45ç§’</li>
<li>æŒ‚èµ·çš„è·å–æœ€å¤§è®¡æ•°ï¼ˆpendingAcquireMaxCountï¼‰ï¼šè·å–çš„æœ€å¤§æ³¨å†Œè¯·æ±‚æ•°ä»¥ä¿ç•™åœ¨æŒ‚èµ·é˜Ÿåˆ—ä¸­å½“ä½¿ç”¨ -1 è°ƒç”¨æ—¶ï¼ŒæŒ‚èµ·é˜Ÿåˆ—å°†æ²¡æœ‰ä¸Šé™ã€‚é»˜è®¤ä¸º<code>2 * max connections</code>.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//æœ€å¤§è¿æ¥æ•°ã€æœ€å¤§ç©ºé—²æ—¶é—´ã€æœ€å¤§å­˜æ´»æ—¶é—´ã€è·å–è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span class="line"><span class="cl"><span class="c1">//æŒ‚èµ·çš„è·å–æœ€å¤§è®¡æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1">//åœ¨åå°è¢«é©±é€æ—¶é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ConnectionProvider</span> <span class="n">provider</span> <span class="o">=</span> <span class="n">ConnectionProvider</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&#34;fixed&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">maxConnections</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">maxIdleTime</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">60</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">maxLifeTime</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">60</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">pendingAcquireTimeout</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">60</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">pendingAcquireMaxCount</span><span class="o">(</span><span class="mi">20000</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">evictInBackground</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">120</span><span class="o">)).</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//é…ç½®Netty selectçº¿ç¨‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">HttpClient</span> <span class="n">httpClient</span> <span class="o">=</span> <span class="n">HttpClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">provider</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  							<span class="o">.</span><span class="na">tcpConfiguration</span><span class="o">(</span><span class="n">tcpClient</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                     <span class="c1">//æŒ‡å®šNettyçš„select å’Œ workçº¿ç¨‹æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                     <span class="n">LoopResources</span> <span class="n">loop</span> <span class="o">=</span> <span class="n">LoopResources</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&#34;kl-event-loop&#34;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                     <span class="k">return</span> <span class="n">tcpClient</span><span class="o">.</span><span class="na">doOnConnected</span><span class="o">(</span><span class="n">connection</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                         <span class="c1">//è¯»å†™è¶…æ—¶è®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                         <span class="n">connection</span><span class="o">.</span><span class="na">addHandlerLast</span><span class="o">(</span><span class="k">new</span> <span class="n">ReadTimeoutHandler</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                                 <span class="o">.</span><span class="na">addHandlerLast</span><span class="o">(</span><span class="k">new</span> <span class="n">WriteTimeoutHandler</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                     <span class="o">})</span>
</span></span><span class="line"><span class="cl">                       <span class="c1">//è¿æ¥è¶…æ—¶è®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                       <span class="o">.</span><span class="na">option</span><span class="o">(</span><span class="n">ChannelOption</span><span class="o">.</span><span class="na">CONNECT_TIMEOUT_MILLIS</span><span class="o">,</span> <span class="mi">10000</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                       <span class="o">.</span><span class="na">option</span><span class="o">(</span><span class="n">ChannelOption</span><span class="o">.</span><span class="na">TCP_NODELAY</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                       <span class="o">.</span><span class="na">runOn</span><span class="o">(</span><span class="n">loop</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                 <span class="o">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WebClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">clientConnector</span><span class="o">(</span><span class="k">new</span> <span class="n">ReactorClientHttpConnector</span><span class="o">(</span><span class="n">httpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><h3 id="webclient-ä½¿ç”¨ä¸Šå¸¸è§é—®é¢˜">WebClient ä½¿ç”¨ä¸Šå¸¸è§é—®é¢˜</h3>
<h4 id="1-poolacquirependinglimitexception">1 PoolAcquirePendingLimitException</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Pending</span> <span class="n">acquire</span> <span class="n">queue</span> <span class="n">has</span> <span class="n">reached</span> <span class="n">its</span> <span class="n">maximum</span> <span class="n">size</span> <span class="n">of</span> <span class="mi">1000</span><span class="o">;</span> <span class="n">nested</span> <span class="n">exception</span> <span class="n">is</span> <span class="n">reactor</span><span class="o">.</span><span class="na">netty</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">shaded</span><span class="o">.</span><span class="na">reactor</span><span class="o">.</span><span class="na">pool</span><span class="o">.</span><span class="na">PoolAcquirePendingLimitException</span><span class="o">:</span> <span class="n">Pending</span> <span class="n">acquire</span> <span class="n">queue</span> <span class="n">has</span> <span class="n">reached</span> <span class="n">its</span> <span class="n">maximum</span> <span class="n">size</span> <span class="n">of</span> <span class="mi">1000</span>
</span></span></code></pre></div><p>WebClientéœ€è¦ä¸€ä¸ªHTTPå®¢æˆ·ç«¯åº“æ¥æ‰§è¡Œè¯·æ±‚ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨Reactor Nettyï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ä¸€ä¸ªâ€œå›ºå®šâ€è¿æ¥æ± ï¼Œå…¶ä¸­500ä¸ªæ˜¯æ´»åŠ¨é€šé“çš„æœ€å¤§æ•°é‡ï¼Œ1000ä¸ªæ˜¯å…è®¸ä¿æŒåœ¨æŒ‚èµ·çŠ¶æ€çš„è¿›ä¸€æ­¥é€šé“è·å–å°è¯•çš„æœ€å¤§æ•°é‡ã€‚</p>
<p>åªè¦åˆ›å»ºçš„é€šé“å°‘äº500ä¸ªï¼Œå¹¶ä¸”ç”±æ± ç®¡ç†ï¼Œé‚£ä¹ˆå®ç°å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°é€šé“ã€‚
å½“è¾¾åˆ°æ± ä¸­é€šé“çš„æœ€å¤§æ•°é‡æ—¶ï¼Œæœ€å¤šä¼šå»¶è¿Ÿï¼ˆæŒ‚èµ·ï¼‰1000æ¬¡è·å–é€šé“çš„æ–°å°è¯•ï¼Œç›´åˆ°é€šé“å†æ¬¡è¿”å›åˆ°æ± ä¸­ï¼Œå¹¶ä¸”ä¼šæ‹’ç»è¿›ä¸€æ­¥å°è¯•ï¼Œå¹¶å‡ºç°é”™è¯¯ã€‚</p>
<p><strong>ä½ æœ‰ä¸¤ä¸ªé€‰æ‹©æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‚ç›´æ‰©å±•ï¼šå¢åŠ è¿æ¥æ± å¤§å°å’Œ/æˆ–è·å–é˜Ÿåˆ—é•¿åº¦ï¼Œæ°´å¹³æ‰©å±•ï¼šåˆ›å»ºåº”ç”¨ç¨‹åºçš„å…¶ä»–å®ä¾‹ã€‚</strong></p>
<p>1.1 å‚ç›´æ‰©å±•ï¼šå¢åŠ è¿æ¥æ± å¤§å°å’Œ/æˆ–è·å–é˜Ÿåˆ—é•¿åº¦</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ConnectionProvider</span> <span class="n">connectionProvider</span> <span class="o">=</span> <span class="n">ConnectionProvider</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&#34;myConnectionPool&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">maxConnections</span><span class="o">(&lt;</span><span class="n">your_desired_max_connections</span><span class="o">&gt;)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">pendingAcquireMaxCount</span><span class="o">(&lt;</span><span class="n">your_desired_pending_queue_size</span><span class="o">&gt;)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">ReactorClientHttpConnector</span> <span class="n">clientHttpConnector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReactorClientHttpConnector</span><span class="o">(</span><span class="n">HttpClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">connectionProvider</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="n">WebClient</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">clientConnector</span><span class="o">(</span><span class="n">clientHttpConnector</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><p>1.2 æ°´å¹³æ‰©å±•ï¼šåˆ›å»ºåº”ç”¨ç¨‹åºçš„å…¶ä»–å®ä¾‹ï¼Œå¹¶åœ¨å®ä¾‹ä¹‹é—´å¹³è¡¡apiè°ƒç”¨çš„è´Ÿè½½ã€‚
åœ¨è®¡ç®—è¿æ¥æ± çš„å¤§å°æ—¶ï¼Œå€¼å¾—è€ƒè™‘ä¸‹æ¸¸apiè°ƒç”¨çš„å»¶è¿Ÿã€‚
<code>connection_pool_size=tps * downstream_api_latency</code>
<code>tpsï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰</code></p>
<h3 id="2-connection-reset-by-peer-exception">2 Connection reset by peer exception</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Connection</span> <span class="n">reset</span> <span class="n">by</span> <span class="n">peer</span> <span class="n">exception</span>
</span></span></code></pre></div><p>ç”±äºæ²¡æœ‰è®¾ç½®åˆç†çš„è¿æ¥æ± æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ã€‚</p>
<p><a href="https://github.com/reactor/reactor-netty/issues/1774"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/reactor/reactor-netty/issues/1774</a></p>
<h1 id="æ„å»ºhttpè¯·æ±‚ç¤ºä¾‹">æ„å»ºHTTPè¯·æ±‚ç¤ºä¾‹</h1>
<h2 id="1-getè¯·æ±‚ç¤ºä¾‹">1 GETè¯·æ±‚ç¤ºä¾‹</h2>
<p>URIæ„é€ æ—¶æ”¯æŒå±æ€§å ä½ç¬¦ï¼ŒçœŸå®å‚æ•°åœ¨å…¥å‚æ—¶æ’åºå¥½å°±å¯ä»¥ã€‚åŒæ—¶å¯ä»¥é€šè¿‡acceptè®¾ç½®åª’ä½“ç±»å‹ï¼Œä»¥åŠç¼–ç ã€‚æœ€ç»ˆçš„ç»“æœå€¼æ˜¯é€šè¿‡Monoå’ŒFluxæ¥æ¥æ”¶çš„ï¼Œåœ¨subscribeæ–¹æ³•ä¸­è®¢é˜…è¿”å›å€¼ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">WebClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">WebClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&#34;http://www.compay.com&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Mono</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="s">&#34;/book/{id}.html&#34;</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">acceptCharset</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">TEXT_HTML</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span></code></pre></div><p>å¦‚æœéœ€è¦æºå¸¦å¤æ‚çš„æŸ¥è¯¢å‚æ•°ï¼Œå¯ä»¥é€šè¿‡UriComponentsBuilderæ„é€ å‡ºURLè¯·æ±‚åœ°å€ï¼Œå¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//å®šä¹‰queryå‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">MultiValueMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedMultiValueMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl"><span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="s">&#34;daybreak&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å®šä¹‰urlå‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">uriVariables</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl"><span class="n">uriVariables</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">,</span> <span class="mi">200</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">UriComponentsBuilder</span><span class="o">.</span><span class="na">fromUriString</span><span class="o">(</span><span class="s">&#34;/book/{id}.html&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="n">params</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">uriVariables</span><span class="o">(</span><span class="n">uriVariables</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">toUriString</span><span class="o">();</span>
</span></span></code></pre></div><h2 id="2-postè¯·æ±‚ç¤ºä¾‹">2 POSTè¯·æ±‚ç¤ºä¾‹</h2>
<p>POSTè¯·æ±‚ç¤ºä¾‹æ¼”ç¤ºäº†ä¸€ä¸ªåŒæ—¶åŒ…å«è¡¨å•å‚æ•°å’Œæ–‡ä»¶æµæ•°æ®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">WebClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">WebClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&#34;http://www.compay.com&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">FormInserter</span> <span class="n">formInserter</span> <span class="o">=</span> <span class="n">fromMultipartData</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span><span class="s">&#34;daybreak&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&#34;map&#34;</span><span class="o">,</span><span class="n">ImmutableMap</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;xx&#34;</span><span class="o">,</span><span class="s">&#34;xx&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&#34;file&#34;</span><span class="o">,</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;d://xxx.doc&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="n">Mono</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">post</span><span class="o">().</span><span class="na">uri</span><span class="o">(</span><span class="s">&#34;/book/{id}.html&#34;</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">formInserter</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span></code></pre></div><p>æ™®é€šPOSTè¯·æ±‚ï¼Œç›´æ¥é€šè¿‡bodyValueè®¾ç½®å¯¹è±¡å®ä¾‹å³å¯ã€‚ä¸ç”¨FormInserteræ„é€ </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">WebClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">WebClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&#34;http://www.compay.com&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Mono</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">post</span><span class="o">().</span><span class="na">uri</span><span class="o">(</span><span class="s">&#34;/book/{id}.html&#34;</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">bodyValue</span><span class="o">(</span><span class="n">ImmutableMap</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span><span class="s">&#34;daybreak&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span></code></pre></div><h2 id="3-åŒæ­¥è¿”å›ç»“æœ">3 åŒæ­¥è¿”å›ç»“æœ</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">WebClient</span> <span class="n">client</span> <span class="o">=</span>  <span class="n">WebClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&#34;http://www.compay.com&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">client</span> <span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">uri</span><span class="o">(</span><span class="s">&#34;/book/{id}.html&#34;</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="na">block</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
</span></span></code></pre></div><h2 id="4-å¼‚å¸¸å¤„ç†">4 å¼‚å¸¸å¤„ç†</h2>
<p>å¯ä»¥ä½¿ç”¨OnStatusæ ¹æ®status codeè¿›è¡Œå¼‚å¸¸é€‚é…ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨doOnErrorå¼‚å¸¸é€‚é…</p>
<p>å¯ä»¥ä½¿ç”¨onErrorReturnè¿”å›æŒ‡å®šé»˜è®¤è¿”å›å€¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">WebClient</span> <span class="n">webClient</span> <span class="o">=</span> <span class="n">WebClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">baseUrl</span><span class="o">(</span><span class="s">&#34;https://api.compay.com&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">defaultHeader</span><span class="o">(</span><span class="n">HttpHeaders</span><span class="o">.</span><span class="na">CONTENT_TYPE</span><span class="o">,</span> <span class="s">&#34;application/json&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">defaultHeader</span><span class="o">(</span><span class="n">HttpHeaders</span><span class="o">.</span><span class="na">USER_AGENT</span><span class="o">,</span> <span class="s">&#34;Spring 5 WebClient&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">WebClient</span><span class="o">.</span><span class="na">ResponseSpec</span> <span class="n">responseSpec</span> <span class="o">=</span> <span class="n">webClient</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="s">&#34;/user/list?sort={sortField}&#34;</span><span class="o">,</span> <span class="s">&#34;updated&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">retrieve</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Mono</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">mono</span> <span class="o">=</span> <span class="n">responseSpec</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">onStatus</span><span class="o">(</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">is4xxClientError</span><span class="o">(),</span><span class="n">resp</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">LOGGER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;error:{},msg:{}&#34;</span><span class="o">,</span><span class="n">resp</span><span class="o">.</span><span class="na">statusCode</span><span class="o">().</span><span class="na">value</span><span class="o">(),</span><span class="n">resp</span><span class="o">.</span><span class="na">statusCode</span><span class="o">().</span><span class="na">getReasonPhrase</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Mono</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">resp</span><span class="o">.</span><span class="na">statusCode</span><span class="o">().</span><span class="na">value</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; : &#34;</span> <span class="o">+</span> <span class="n">resp</span><span class="o">.</span><span class="na">statusCode</span><span class="o">().</span><span class="na">getReasonPhrase</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">        <span class="o">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">doOnError</span><span class="o">(</span><span class="n">WebClientResponseException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">err</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;ERROR status:{},msg:{}&#34;</span><span class="o">,</span><span class="n">err</span><span class="o">.</span><span class="na">getRawStatusCode</span><span class="o">(),</span><span class="n">err</span><span class="o">.</span><span class="na">getResponseBodyAsString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">onErrorReturn</span><span class="o">(</span><span class="s">&#34;fallback&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">mono</span><span class="o">.</span><span class="na">block</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;result:{}&#34;</span><span class="o">,</span><span class="n">result</span><span class="o">);</span>
</span></span></code></pre></div><h1 id="æ€§èƒ½å¯¹æ¯”æµ‹è¯•">æ€§èƒ½å¯¹æ¯”æµ‹è¯•</h1>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œæ€§èƒ½å¯¹æ¯”æµ‹è¯•ã€‚</p>
<p>åœ¨æŸä¸ªä¸šåŠ¡åœºæ™¯ä¸­æˆ‘ä»¬ä½¿ç”¨äº†RestTemplateï¼Œå€Ÿæ­¤åˆ†æä¸‹WebClient ä¸ RestTemplate ä¸¤è€…çš„æ€§èƒ½å®é™…è¡¨ç°ï¼Œé€šè¿‡å®é™…çš„æ¡ˆä¾‹æ€§èƒ½å¯¹æ¯”ï¼Œçœ‹çœ‹WebClient æ˜¯å¦æœ‰å¦‚æ­¤ä¼˜ç§€ã€‚</p>
<h2 id="ä¸šåŠ¡åœºæ™¯è¯´æ˜">ä¸šåŠ¡åœºæ™¯è¯´æ˜</h2>
<p>åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæ˜¯ä¸€ä¸ªå¼‚æ­¥å¤„ç†çš„åœºæ™¯ã€‚å½“å®ŒæˆæŸé¡¹ä¸šåŠ¡åï¼Œè¿›è¡ŒHTTPå¼‚æ­¥é€šçŸ¥å¤„ç†ã€‚è¿™ä¸ªä¹Ÿæ˜¯åœ¨ä¸šåŠ¡å¼€å‘ä¸­æ¯”è¾ƒåœºæ™¯çš„ä¸€ç§åœºæ™¯ã€‚</p>
<h2 id="æµ‹è¯•æ–¹æ¡ˆè®¾è®¡">æµ‹è¯•æ–¹æ¡ˆè®¾è®¡</h2>
<h3 id="å»¶è¿Ÿçš„è´Ÿè½½æµ‹è¯•åˆ†æ">å»¶è¿Ÿçš„è´Ÿè½½æµ‹è¯•åˆ†æ</h3>
<p>æ­å»ºå¾…æµ‹è¯•é¡¹ç›®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">AtomicInteger</span> <span class="n">metrics</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/check&#34;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">check</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100L</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;success_&#34;</span> <span class="o">+</span> <span class="n">metrics</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><h3 id="callerè®¾è®¡">Callerè®¾è®¡</h3>
<p>1 ThreadPoolTaskExecutor + RestTemplate</p>
<p>é€šè¿‡çº¿ç¨‹ç»„ç»„åˆ RestTemplate å®ç°å¼‚æ­¥HTTPè¯·æ±‚ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">		<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">poolSize</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">availableProcessors</span><span class="o">(),</span> <span class="mi">8</span><span class="o">)</span> <span class="o">*</span> <span class="mi">2</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">queueSize</span> <span class="o">=</span> <span class="mi">20000</span><span class="o">;</span>	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">		<span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">TaskExecutor</span> <span class="nf">listenerExecutor</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ThreadPoolTaskExecutor</span> <span class="n">pool</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadPoolTaskExecutor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setCorePoolSize</span><span class="o">(</span><span class="n">poolSize</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setMaxPoolSize</span><span class="o">(</span><span class="n">poolSize</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setQueueCapacity</span><span class="o">(</span><span class="n">queueSize</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setRejectedExecutionHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="o">.</span><span class="na">CallerRunsPolicy</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setWaitForTasksToCompleteOnShutdown</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setAwaitTerminationSeconds</span><span class="o">(</span><span class="mi">60</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">pool</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><ul>
<li>corePoolSizeï¼šMath.max(Runtime.getRuntime().availableProcessors(), 8) * 2</li>
<li>maxPoolSizeï¼šMath.max(Runtime.getRuntime().availableProcessors(), 8) * 2</li>
<li>queueCapacityï¼š20000</li>
<li>rejectedExecutionHandlerï¼šCallerRunsPolicy</li>
</ul>
<p>2 AsyncRestTemplate</p>
<p>åŸå®˜æ–¹çš„çº¿ç¨‹ç»„+RestTemplateæ–¹æ³•ï¼Œåœ¨Spring5.0ä»¥åŠåºŸå¼ƒï¼Œæ›¿æ¢æ¢WebClientã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">		<span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">AsyncRestTemplate</span> <span class="nf">asyncRestTemplate</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">SimpleClientHttpRequestFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleClientHttpRequestFactory</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">factory</span><span class="o">.</span><span class="na">setConnectTimeout</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">factory</span><span class="o">.</span><span class="na">setReadTimeout</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">ThreadPoolTaskExecutor</span> <span class="n">pool</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadPoolTaskExecutor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">poolSize</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">availableProcessors</span><span class="o">(),</span> <span class="mi">8</span><span class="o">)</span> <span class="o">*</span> <span class="mi">2</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setCorePoolSize</span><span class="o">(</span><span class="n">poolSize</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setMaxPoolSize</span><span class="o">(</span><span class="n">poolSize</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setQueueCapacity</span><span class="o">(</span><span class="mi">20000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setRejectedExecutionHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="o">.</span><span class="na">CallerRunsPolicy</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setWaitForTasksToCompleteOnShutdown</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">setAwaitTerminationSeconds</span><span class="o">(</span><span class="mi">60</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">pool</span><span class="o">.</span><span class="na">initialize</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">factory</span><span class="o">.</span><span class="na">setTaskExecutor</span><span class="o">(</span><span class="n">pool</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">AsyncRestTemplate</span><span class="o">(</span><span class="n">factory</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><ul>
<li>corePoolSizeï¼šMath.max(Runtime.getRuntime().availableProcessors(), 8) * 2</li>
<li>maxPoolSizeï¼šMath.max(Runtime.getRuntime().availableProcessors(), 8) * 2</li>
<li>queueCapacityï¼š20000</li>
<li>rejectedExecutionHandlerï¼šCallerRunsPolicy</li>
</ul>
<p>WebClientï¼šå¼‚æ­¥éé˜»å¡ã€ååº”å¼çš„ï¼Œèƒ½å¤Ÿä»¥å°‘é‡å›ºå®šçš„çº¿ç¨‹å¤„ç†é«˜å¹¶å‘çš„HTTP è¯·æ±‚ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">		<span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">WebClient</span> <span class="nf">webClient</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">ConnectionProvider</span> <span class="n">provider</span> <span class="o">=</span> <span class="n">ConnectionProvider</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&#34;fixed&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">maxConnections</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">maxIdleTime</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">60</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">maxLifeTime</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">60</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">pendingAcquireTimeout</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">60</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">pendingAcquireMaxCount</span><span class="o">(</span><span class="mi">1000</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">WebClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">clientConnector</span><span class="o">(</span><span class="k">new</span> <span class="n">ReactorClientHttpConnector</span><span class="o">(</span><span class="n">HttpClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">provider</span><span class="o">))).</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><ul>
<li>æœ€å¤§è¿æ¥æ•°ï¼ˆmaxConnectionsï¼‰ï¼š200</li>
<li>æœ€å¤§ç©ºé—²æ—¶é—´ï¼ˆmaxIdleTimeï¼‰ï¼š60s</li>
<li>æœ€å¤§å­˜æ´»æ—¶é—´ï¼ˆmaxLifeTimeï¼‰ï¼š60s</li>
<li>ç­‰å¾…è·å–æ—¶é—´ï¼ˆpendingAcquireTimeoutï¼‰ï¼š60s</li>
<li>æŒ‚èµ·çš„è·å–æœ€å¤§è®¡æ•°ï¼ˆpendingAcquireMaxCountï¼‰ï¼š1000</li>
</ul>
<h2 id="æµ‹è¯•ç»“æœåˆ†æ">æµ‹è¯•ç»“æœåˆ†æ</h2>
<h3 id="1-threadpooltaskexecutor--resttemplate">1 ThreadPoolTaskExecutor + RestTemplate</h3>
<table>
<thead>
<tr>
<th style="text-align:center">ç”¨æˆ·é‡</th>
<th style="text-align:center">çº¿ç¨‹æ•°</th>
<th>ååé‡(req/sec)</th>
<th>95%(ms)</th>
<th>å»¶è¿Ÿå®Œæˆ(min)</th>
<th>å †å†…å­˜(Mb)</th>
<th>CPUå ç”¨ç‡</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">100</td>
<td style="text-align:center">44</td>
<td>168</td>
<td>1</td>
<td>0</td>
<td>100</td>
<td>3</td>
</tr>
<tr>
<td style="text-align:center">200</td>
<td style="text-align:center">42</td>
<td>334</td>
<td>1</td>
<td>1</td>
<td>100</td>
<td>3</td>
</tr>
<tr>
<td style="text-align:center">400</td>
<td style="text-align:center">92</td>
<td>602</td>
<td>115</td>
<td>1</td>
<td>100</td>
<td>3</td>
</tr>
<tr>
<td style="text-align:center">800</td>
<td style="text-align:center">232</td>
<td>972</td>
<td>533</td>
<td>2</td>
<td>100</td>
<td>3</td>
</tr>
<tr>
<td style="text-align:center">1200</td>
<td style="text-align:center">232</td>
<td>1007</td>
<td>1175</td>
<td>2</td>
<td>150</td>
<td>4</td>
</tr>
<tr>
<td style="text-align:center">1600</td>
<td style="text-align:center">232</td>
<td>1003</td>
<td>1683</td>
<td>3</td>
<td>200</td>
<td>5</td>
</tr>
</tbody>
</table>
<p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="../images/resttemplate.jpg"
    data-srcset="../images/resttemplate.jpg, ../images/resttemplate.jpg 1.5x, ../images/resttemplate.jpg 2x"
    data-sizes="auto"
    alt="resttemplate"
    title="resttemplate"/></p>
<h3 id="2-asyncresttemplate">2 AsyncRestTemplate</h3>
<table>
<thead>
<tr>
<th style="text-align:center">ç”¨æˆ·é‡</th>
<th style="text-align:center">çº¿ç¨‹æ•°</th>
<th>ååé‡(req/sec)</th>
<th>95%(ms)</th>
<th>å»¶è¿Ÿå®Œæˆ(min)</th>
<th>å †å†…å­˜(Mb)</th>
<th>CPUå ç”¨ç‡</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">100</td>
<td style="text-align:center">47</td>
<td>168</td>
<td>1</td>
<td>0</td>
<td>200</td>
<td>3</td>
</tr>
<tr>
<td style="text-align:center">200</td>
<td style="text-align:center">37</td>
<td>334</td>
<td>1</td>
<td>2</td>
<td>300-500</td>
<td>3</td>
</tr>
<tr>
<td style="text-align:center">400</td>
<td style="text-align:center">93</td>
<td>603</td>
<td>111</td>
<td>3</td>
<td>400-500</td>
<td>5</td>
</tr>
<tr>
<td style="text-align:center">800</td>
<td style="text-align:center">169</td>
<td>981</td>
<td>127</td>
<td>3</td>
<td>1000</td>
<td>5</td>
</tr>
<tr>
<td style="text-align:center">1200</td>
<td style="text-align:center">235</td>
<td>1633</td>
<td>215</td>
<td>3</td>
<td>1000</td>
<td>5</td>
</tr>
<tr>
<td style="text-align:center">1600</td>
<td style="text-align:center">235</td>
<td>1869</td>
<td>417</td>
<td>3</td>
<td>1000</td>
<td>5</td>
</tr>
</tbody>
</table>
<p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="../images/async-resttemplate2.jpg"
    data-srcset="../images/async-resttemplate2.jpg, ../images/async-resttemplate2.jpg 1.5x, ../images/async-resttemplate2.jpg 2x"
    data-sizes="auto"
    alt="async-resttemplate2"
    title="async-resttemplate2"/></p>
<h3 id="3-webclient">3 Webclient</h3>
<table>
<thead>
<tr>
<th>ç”¨æˆ·é‡</th>
<th>çº¿ç¨‹æ•°</th>
<th>ååé‡(req/sec)</th>
<th>95%(ms)</th>
<th>å»¶è¿Ÿå®Œæˆ(min)</th>
<th>å †å†…å­˜(Mb)</th>
<th>CPUå ç”¨ç‡</th>
<th style="text-align:center">ä¿¡æ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>100</td>
<td>38</td>
<td>168</td>
<td>1</td>
<td>0</td>
<td>100</td>
<td>2</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>200</td>
<td>37</td>
<td>335</td>
<td>1</td>
<td>0</td>
<td>100</td>
<td>2</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>400</td>
<td>37</td>
<td>667</td>
<td>1</td>
<td>0</td>
<td>100</td>
<td>2</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>800</td>
<td>43</td>
<td>1334</td>
<td>1</td>
<td>0</td>
<td>100</td>
<td>3</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>1200</td>
<td>50</td>
<td>2000</td>
<td>1</td>
<td>0</td>
<td>110</td>
<td>4</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>1400</td>
<td>43</td>
<td>2326</td>
<td>1</td>
<td>0</td>
<td>120</td>
<td>5</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>1600</td>
<td>51</td>
<td>2632</td>
<td>1</td>
<td>0</td>
<td>130</td>
<td>5</td>
<td style="text-align:center">PoolAcquirePendingLimitException</td>
</tr>
<tr>
<td>1800</td>
<td>44</td>
<td>3031</td>
<td>1</td>
<td>0</td>
<td>150</td>
<td>6</td>
<td style="text-align:center">PoolAcquirePendingLimitException</td>
</tr>
<tr>
<td>2000</td>
<td>48</td>
<td>3334</td>
<td>1</td>
<td>0</td>
<td>200</td>
<td>7</td>
<td style="text-align:center">PoolAcquirePendingLimitException</td>
</tr>
<tr>
<td>2400</td>
<td>51</td>
<td>4000</td>
<td>1</td>
<td>0</td>
<td>250</td>
<td>8</td>
<td style="text-align:center">PoolAcquirePendingLimitException</td>
</tr>
<tr>
<td>3000</td>
<td>54</td>
<td>4994</td>
<td>1</td>
<td>0</td>
<td>500</td>
<td>10</td>
<td style="text-align:center">PoolAcquirePendingLimitException</td>
</tr>
<tr>
<td>4000</td>
<td>83</td>
<td>6666</td>
<td>1</td>
<td>0</td>
<td>800</td>
<td>15</td>
<td style="text-align:center">PoolAcquirePendingLimitException</td>
</tr>
<tr>
<td>5000</td>
<td>130</td>
<td>8308</td>
<td>1</td>
<td>0</td>
<td>1000</td>
<td>20</td>
<td style="text-align:center">PoolAcquirePendingLimitException</td>
</tr>
</tbody>
</table>
<p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="../images/webclient2.jpg"
    data-srcset="../images/webclient2.jpg, ../images/webclient2.jpg 1.5x, ../images/webclient2.jpg 2x"
    data-sizes="auto"
    alt="webclient2"
    title="webclient2"/></p>
<p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="../images/image-20230116151614439.png"
    data-srcset="../images/image-20230116151614439.png, ../images/image-20230116151614439.png 1.5x, ../images/image-20230116151614439.png 2x"
    data-sizes="auto"
    alt="image-20230116151614439"
    title="image-20230116151614439"/></p>
<h3 id="å‹æµ‹ç»“è®º">å‹æµ‹ç»“è®º</h3>
<p>1.ThreadPoolTaskExecutor + RestTemplateï¼Œç”¨æˆ·å¹¶å‘é‡åœ¨800ï¼Œååé‡å¯ä»¥è¾¾åˆ°972/sï¼Œä½†æ˜¯tomcatçº¿ç¨‹è¢«æ‰“æ»¡ï¼Œå·²ç»å‡ºç°äº†å»¶è¿Ÿç­‰å¾…çš„ç°è±¡ï¼ˆç”±äºä½¿ç”¨çš„æ˜¯CallerRunsPolicyç­–ç•¥ï¼‰ã€‚</p>
<p>2.AsyncRestTemplateï¼Œç”¨æˆ·å¹¶å‘é‡åœ¨800ï¼Œååé‡981/sï¼Œçº¿ç¨‹æ•°169åŸºæœ¬ä¹Ÿè¿›å…¥CallerRunsPolicyç­–ç•¥ã€‚</p>
<p>3.Webclientï¼Œç”¨æˆ·å¹¶å‘é‡åœ¨1400ï¼Œååé‡2326/sï¼Œçº¿ç¨‹æ•°ã€å†…å­˜ã€cpuéƒ½ç›¸å¯¹é—®é¢˜ï¼Œç”±äºWebclientæ˜¯å¼‚æ­¥éé˜»å¡çš„ï¼Œä¸èƒ½åƒçº¿ç¨‹æ± ä¸€æ ·è®¾ç½®æ‰§è¡ŒCallerRunsPolicyç­–ç•¥ï¼Œå½“ç”¨æˆ·å¹¶å‘é‡1600è¾¾åˆ°æ€§èƒ½ç“¶é¢ˆï¼Œå¼€å§‹è§¦å‘PoolAcquirePendingLimitExceptionå¼‚å¸¸ï¼ŒWebclientçš„å¼Šç«¯åœ¨ä¸šåŠ¡çš„åšå¥½å®¹é‡è§„åˆ’ï¼Œåšå¥½å¯¹åº”çš„å‚ç›´ã€æ°´å¹³æ‰©å±•ä»¥åŠå¤±è´¥æƒ…å†µçš„fallbackã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>WebClientæ€§èƒ½éå¸¸ä¼˜å¼‚ï¼ŒåŒæ ·èƒ½å¤Ÿä»¥å°‘é‡è€Œå›ºå®šçš„çº¿ç¨‹æ•°å¤„ç†é«˜å¹¶å‘çš„Httpè¯·æ±‚ï¼Œåœ¨åŸºäºHttpçš„æœåŠ¡é—´é€šä¿¡æ–¹é¢ï¼Œå®Œå…¨å¯ä»¥å–ä»£RestTemplateä»¥åŠAsyncRestTemplateã€‚</p>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://blog.51cto.com/liukang/2090211"target="_blank" rel="external nofollow noopener noreferrer">https://blog.51cto.com/liukang/2090211</a></li>
<li><a href="https://projectreactor.io/docs/netty/snapshot/reference/index.html#_connection_pool_2"target="_blank" rel="external nofollow noopener noreferrer">https://projectreactor.io/docs/netty/snapshot/reference/index.html#_connection_pool_2</a></li>
</ul></div><div class="post-footer">
    <a href="/posts/webclient%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B8%8E%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%95/">é˜…è¯»å…¨æ–‡</a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/webclient/' class="post-tag">webclient</a><a href='/tags/java/' class="post-tag">Java</a><a href='/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/' class="post-tag">æ€§èƒ½åˆ†æ</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h1 class="single-title" itemprop="name headline">
    <span title="è½¬è½½" class="icon-repost"><i class="fa-solid fa-share fa-fw" aria-hidden="true"></i></span><a href="/posts/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">å•å…ƒæµ‹è¯•æœ€ä½³å®è·µ</a>
  </h1><div class="post-meta"><span class="post-author"><span class="author"><img
    class="lazyload avatar"
    src="/svg/loading.min.svg"
    data-src="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c,%20string=%29"
    data-srcset="/assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 1.5x, /assets/avatar.png?s=32&amp;d=localhost:1313%25!%28EXTRA%20string=09f6ba2c1a27e4f0245271e28bf8417c%2c%20string=%29 2x"
    data-sizes="auto"
    alt="j5land"
    title="j5land"/>&nbsp;j5land</span></span>&nbsp;<span class="post-publish" title='2022-11-21 14:02:25'>å‘å¸ƒäº <time datetime="2022-11-21">2022-11-21</time></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/java/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Java</a></span></div><div class="content">èƒŒæ™¯ åœ¨è¿‘æœŸçš„ä»£ç é‡æ„çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°å„å¼å„æ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚è°ƒæ•´ä»£ç é¡ºåºå¯¼è‡´çš„bugï¼Œæ–¹æ³•é‡æ„å‚æ•°æ ¡éªŒé€»è¾‘çš„ç§»é™¤ç­‰ã€‚ åœ¨ä¸Šçº¿å‰éœ€è¦èŠ±å¤§é‡æ—¶é—´è¿›è¡Œæµ‹è¯•</div><div class="post-footer">
    <a href="/posts/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">é˜…è¯»å…¨æ–‡</a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/' class="post-tag">å•å…ƒæµ‹è¯•</a><a href='/tags/mockito/' class="post-tag">Mockito</a></div></div>
</article>
<ul class="pagination"><li class="page-item">
          <span class="page-link">
            <a href="/">1</a>
          </span>
        </li><li class="page-item">
          <span class="page-link">
            <a href="/page/2/">2</a>
          </span>
        </li><li class="page-item active">
          <span class="page-link">
            <a href="/page/3/">3</a>
          </span>
        </li><li class="page-item">
          <span class="page-link">
            <a href="/page/4/">4</a>
          </span>
        </li><li class="page-item">
          <span class="page-link">
            <a href="/page/5/">5</a>
          </span>
        </li><li class="page-item">
          <span class="page-link">
            <a href="/page/6/">6</a>
          </span>
        </li></ul></div></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">Copyright Â© J5land Blog 2023
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2021 - 2024</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class="site-time" title='ç½‘ç«™è¿è¡Œä¸­ ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden="true"></i><span class="ms-1 d-none">åšå®¢å·²è¿è¡Œ</span><span class="run-times ms-1">ç½‘ç«™è¿è¡Œä¸­ ...</span></span></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='æ€»è®¿å®¢æ•°'><i class="fa-regular fa-user fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='æ€»è®¿é—®é‡'><i class="fa-regular fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="å›åˆ°é¡¶éƒ¨"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div><div class="fixed-button view-comments d-none" role="button" aria-label="æŸ¥çœ‹è¯„è®º"><i class="fa-solid fa-comment fa-fw" aria-hidden="true"></i></div></div><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">FixIt ä¸»é¢˜åœ¨å¯ç”¨ JavaScript çš„æƒ…å†µä¸‹æ•ˆæœæœ€ä½³ã€‚</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/lazysizes/lazysizes.min.js" async defer></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async defer></script><script>window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","editLockTitle":"é”å®šå¯ç¼–è¾‘ä»£ç å—","editUnLockTitle":"è§£é”å¯ç¼–è¾‘ä»£ç å—","editable":true,"maxShownLines":10},"data":{"typeit-profile-subtitle":"ä¸“æ³¨å¹¿å‘ŠæŠ€æœ¯ï¼Œå–œæ¬¢é«˜å¹¶å‘æŠ€æœ¯ï¼Œå­¦ä¹ K8s/å®¹å™¨æŠ€æœ¯ï¼ŒæœŸå¾…ä¸å¤§å®¶åˆ†äº«ç»éªŒï¼Œå…±åŒå­¦ä¹ ã€‚"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":100,"findAllMatches":false,"highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":30,"threshold":0.3,"useExtendedSearch":false},"siteTime":"2020-05-23T16:15:22+08:00","typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"typeit-profile-subtitle":["typeit-profile-subtitle"]},"duration":-1,"speed":100}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
